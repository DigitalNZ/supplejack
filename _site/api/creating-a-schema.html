<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="viewport" content="width=device-width">

        <title>Supplejack : Creating a Schema</title>
        <meta name="description" content="Documentation for the Supplejack stack">

        <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.no-icons.min.css" rel="stylesheet">
        <link rel="stylesheet" href="/supplejack/css/syntax.css">
        <link rel="stylesheet" href="/supplejack/css/main.css">
    </head>
    <body>

        <div class="container">
            <div class=row-fluid>
                <div id=header class=span12>
                    <h4><a class=brand href="/supplejack/">Supplejack</a>
    <small>Documentation for the Supplejack stack</small>
</h4>


                </div>
            </div>

            <div class=row-fluid>
                
                
                    <div id=navigation class=span2>
                        <ul class="nav nav-list">
    <li><a href="/supplejack/">Home</a></li>
    
        
        

        
            
                <li class=nav-header>Getting started</li>
            
            <li data-order="2"><a href="/supplejack/start/install-setup.html">Install & Setup</a></li>
        
            
            <li data-order="1"><a href="/supplejack/start/dependancies.html">Dependancies</a></li>
        
            
            <li data-order="5"><a href="/supplejack/start/supplejack-worker.html">Supplejack Worker</a></li>
        
            
            <li data-order="4"><a href="/supplejack/start/supplejack-manager.html">Supplejack Manager</a></li>
        
            
            <li data-order="3"><a href="/supplejack/start/supplejack-api.html">Supplejack API</a></li>
        
    
        
        

        
            
                <li class=nav-header>Creating your API</li>
            
            <li data-order="1"><a href="/supplejack/api/api-admin.html">API Admin</a></li>
        
            
            <li data-order="2"><a href="/supplejack/api/schema-dsl-domain-specific-language.html">Schema DSL (Domain Specific Language)</a></li>
        
            
            <li data-order="1"><a href="/supplejack/api/creating-a-schema.html">Creating a Schema</a></li>
        
    
        
        

        
            
                <li class=nav-header>Using the manager</li>
            
            <li data-order="1"><a href="/supplejack/manager/introduction-to-parser-scripts.html">Introduction to parser scripts</a></li>
        
            
            <li data-order=""><a href="/supplejack/manager/parser-dsl-domain-specific-language.html">Parser DSL (Domain Specific Language)</a></li>
        
            
            <li data-order=""><a href="/supplejack/manager/validations.html">Validations</a></li>
        
            
            <li data-order=""><a href="/supplejack/manager/xml-namespaces.html">XML Namespaces</a></li>
        
            
            <li data-order=""><a href="/supplejack/manager/attribute-transformation-options.html">Attribute Transformation Options</a></li>
        
            
            <li data-order=""><a href="/supplejack/manager/enrichments.html">Enrichments</a></li>
        
            
            <li data-order=""><a href="/supplejack/manager/modifiers.html">Modifiers</a></li>
        
    
        
        

        
            
                <li class=nav-header>Developers</li>
            
            <li data-order="1"><a href="/supplejack/dev/licence.html">Licence</a></li>
        
            
            <li data-order="3"><a href="/supplejack/dev/changelog.html">Changelog</a></li>
        
    
<!-- List additional links. It is recommended to add a divider
    e.g. <li class=divider></li> first to break up the content. -->
</ul>

                    </div>

                    <div id=content class=span10>
                        <div class=page-header>
    <h1>Creating a Schema
        
    </h1>
</div>

<p>The heart of the Supplejack API is the Schema. This defines the fields for each record and how those fields should be stored and searched. It also defines the different user roles and any restrictions for those roles.</p>

<p>When you first install the Supplejack API a default Schema file is created for (see the code at the bottom of the page for a copy). This gives you a template to start working from but you do not have keep any of the fields which are defined in the example.</p>

<h2 id="toc_0">Schema basics</h2>

<p>To start your Schema from scratch you first need the class definition.</p>
<div class="highlight"><pre><code class="ruby language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">Schema</span> <span class="o">&lt;</span> <span class="no">SupplejackApi</span><span class="o">::</span><span class="no">SupplejackSchema</span>

<span class="k">end</span>
</code></pre></div>
<p>You must name you class <code>Schema</code> and it must inherit from <code>SupplejackApi::SupplejackSchema</code> so that compulsory fields and groups are included in your Schema.</p>

<p>Once you have defined your class you can begin adding fields, groups and roles. For more details about how to do this you can view the <a href="supplejack/api/schema-dsl-domain-specific-language.html">Schema DSL documentation</a>. You must define at least one group and role, and mark them as <code>default</code>, before you can view records from your API.</p>

<h3 id="toc_1">Some common issues</h3>

<ul>
<li>If you already have records saved in Mongo you will have to resave them each time you update your Schema before you see any change in what is returned from the API. </li>
<li>Fields that are already saved will not be removed from the record, in Mongo, if you remove that field from the Schema.</li>
</ul>

<h2 id="toc_2">Example schema</h2>
<div class="highlight"><pre><code class="ruby language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">Schema</span> <span class="o">&lt;</span> <span class="no">SupplejackApi</span><span class="o">::</span><span class="no">SupplejackSchema</span>

  <span class="c1"># Fields</span>
  <span class="n">string</span>    <span class="ss">:name</span><span class="p">,</span>         <span class="n">search_boost</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>      <span class="n">search_as</span><span class="p">:</span> <span class="o">[</span><span class="ss">:filter</span><span class="p">,</span> <span class="ss">:fulltext</span><span class="o">]</span>
  <span class="n">string</span>    <span class="ss">:address</span><span class="p">,</span>      <span class="n">search_boost</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>       <span class="n">search_as</span><span class="p">:</span> <span class="o">[</span><span class="ss">:filter</span><span class="p">,</span> <span class="ss">:fulltext</span><span class="o">]</span>
  <span class="n">string</span>    <span class="ss">:email</span><span class="p">,</span>        <span class="n">multi_value</span><span class="p">:</span> <span class="kp">true</span><span class="p">,</span>     <span class="n">search_as</span><span class="p">:</span> <span class="o">[</span><span class="ss">:filter</span><span class="o">]</span>
  <span class="n">string</span>    <span class="ss">:children</span><span class="p">,</span>     <span class="n">multi_value</span><span class="p">:</span> <span class="kp">true</span>
  <span class="n">string</span>    <span class="ss">:contact</span><span class="p">,</span>      <span class="n">multi_value</span><span class="p">:</span> <span class="kp">true</span>
  <span class="n">integer</span>   <span class="ss">:age</span>
  <span class="n">datetime</span>  <span class="ss">:birth_date</span>
  <span class="n">boolean</span>   <span class="ss">:nz_citizen</span><span class="p">,</span>                          <span class="n">search_as</span><span class="p">:</span> <span class="o">[</span><span class="ss">:filter</span><span class="o">]</span>

  <span class="c1"># Groups</span>
  <span class="n">group</span> <span class="ss">:default</span> <span class="k">do</span>
    <span class="n">fields</span> <span class="o">[</span>
      <span class="ss">:name</span><span class="p">,</span>
      <span class="ss">:address</span>
    <span class="o">]</span>
  <span class="k">end</span>
  <span class="n">group</span> <span class="ss">:all</span> <span class="k">do</span>
    <span class="n">includes</span> <span class="o">[</span><span class="ss">:default</span><span class="o">]</span>
    <span class="n">fields</span> <span class="o">[</span>
      <span class="ss">:email</span><span class="p">,</span>
      <span class="ss">:children</span><span class="p">,</span>
      <span class="ss">:nz_citizen</span><span class="p">,</span>
      <span class="ss">:birth_date</span><span class="p">,</span>
      <span class="ss">:age</span>
    <span class="o">]</span>
  <span class="k">end</span>

   <span class="c1"># Roles</span>
  <span class="n">role</span> <span class="ss">:developer</span> <span class="k">do</span>
    <span class="n">default</span> <span class="kp">true</span>
  <span class="k">end</span>
  <span class="n">role</span> <span class="ss">:admin</span>

<span class="k">end</span>
</code></pre></div>

                    </div>
                
            </div>

            <div class=row-fluid>
                <div id=footer class=span12>
                    Documentation for <a href="https://github.com/DigitalNZ/supplejack_api">Supplejack</a>

                </div>
            </div>
        </div>

        <script>
            function orderNav() {
                var list,
                    section,
                    header,
                    sections = [],
                    lists = {},
                    headers = {};

                var navUl = document.querySelectorAll('#navigation ul')[0],
                    navLis = document.querySelectorAll('#navigation ul li');

                if (!navUl) return;

                for (var i = 0; i < navLis.length; i++) {
                    var order, li = navLis[i];

                    if (li.classList.contains('nav-header')) {
                        section = li.textContent || li.innerText;
                        sections.push(section);
                        headers[section] = li;
                        continue;
                    }

                    if (!lists[section]) {
                        lists[section] = [];
                    }

                    order = parseFloat(li.getAttribute('data-order'))
                    lists[section].push([order, li]);
                }

                for (var i = 0; i < sections.length; i++) {
                    section = sections[i];
                    list = lists[section].sort(function(a, b) {
                        return a[0] - b[0];
                    });

                    if (header = headers[section]) {
                        navUl.appendChild(header);
                    }
                    for (var j = 0; j < list.length; j++) {
                        navUl.appendChild(list[j][1]);
                    }
                }
            }

            if (document.querySelectorAll) orderNav();
        </script>
    </body>
</html>
