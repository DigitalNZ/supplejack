<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="viewport" content="width=device-width">

        <link rel="apple-touch-icon" sizes="144x144" href="/supplejack/apple-touch-icon.png">
        <link rel="icon" type="image/png" sizes="32x32" href="/supplejack/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/supplejack/favicon-16x16.png">
        <link rel="manifest" href="/supplejack/manifest.json">
        <link rel="mask-icon" href="/supplejack/safari-pinned-tab.svg" color="#118a0f">
        <meta name="theme-color" content="#118a0f">

        <title>Supplejack : Supplejack API</title>
        <meta name="description" content="Documentation">

        <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.no-icons.min.css" rel="stylesheet">
        <link rel="stylesheet" href="/supplejack/css/syntax.css">
        <link rel="stylesheet" href="/supplejack/css/main.css">
    </head>
    <body>

        <div class="container">
            <div class=row-fluid>
                <div id=header class=span12>
                    <a href="/supplejack/">
                      <img src="/supplejack/images/supplejack_logo.png" alt='Supplejack' />
                    </a>
                    <small>Documentation (Version 0.1)</small>
                </div>
            </div>

            <div class=row-fluid>
                
                
                    <div id=navigation class=span2>
                        <ul class="nav nav-list">
    <li><a href="/supplejack/">Home</a></li>
    <li><a href="/supplejack/about.html">About</a></li>
    <li><a href="/supplejack/screenshots.html">Screenshots</a></li>
    <li><a href="/supplejack/architecture.html">Architecture</a></li>
    <li><a href="/supplejack/licence.html">Licence</a></li>
    
        
        

        
            
                <li class=nav-header>Installation</li>
            
            <li data-order="11"><a href="/supplejack/start/installation-walk-through-by-example.html">Installation Walk-through by Example</a></li>
        
            
            <li data-order="3"><a href="/supplejack/start/production-install.html">Production Install</a></li>
        
            
            <li data-order="7"><a href="/supplejack/start/supplejack-website.html">Supplejack Website</a></li>
        
            
            <li data-order="6"><a href="/supplejack/start/supplejack-client.html">Supplejack Client</a></li>
        
            
            <li data-order="9"><a href="/supplejack/start/troubleshooting.html">Troubleshooting</a></li>
        
            
            <li data-order="8"><a href="/supplejack/start/supplejack-common.html">Supplejack Common</a></li>
        
            
            <li data-order="2"><a href="/supplejack/start/development-setup.html">Development Setup</a></li>
        
            
            <li data-order="1"><a href="/supplejack/start/dependencies.html">Dependencies</a></li>
        
            
            <li data-order="5"><a href="/supplejack/start/supplejack-worker.html">Supplejack Worker</a></li>
        
            
            <li data-order="4"><a href="/supplejack/start/supplejack-manager.html">Supplejack Manager</a></li>
        
            
            <li data-order="3"><a href="/supplejack/start/supplejack-api.html">Supplejack API</a></li>
        
    
        
        

        
            
                <li class=nav-header>Creating your API</li>
            
            <li data-order="3"><a href="/supplejack/api/api-admin.html">API Admin</a></li>
        
            
            <li data-order="2"><a href="/supplejack/api/schema-dsl-domain-specific-language.html">Schema DSL (Domain Specific Language)</a></li>
        
            
            <li data-order="1"><a href="/supplejack/api/creating-schemas.html">Creating Schemas</a></li>
        
    
        
        

        
            
                <li class=nav-header>Using the API</li>
            
            <li data-order=""><a href="/supplejack/api_usage/metrics-api.html">Metrics API</a></li>
        
            
            <li data-order="2"><a href="/supplejack/api_usage/user-sets.html">Sets API</a></li>
        
            
            <li data-order="1"><a href="/supplejack/api_usage/records-api.html">Records API</a></li>
        
            
            <li data-order="3"><a href="/supplejack/api_usage/concepts-api.html">Concepts API</a></li>
        
    
        
        

        
            
                <li class=nav-header>Using the manager</li>
            
            <li data-order="11"><a href="/supplejack/manager/job-status.html">Job Status</a></li>
        
            
            <li data-order="10"><a href="/supplejack/manager/concept-configuration.html">Concepts Configuration</a></li>
        
            
            <li data-order="9"><a href="/supplejack/manager/linkchecker.html">Link Checker</a></li>
        
            
            <li data-order="8"><a href="/supplejack/manager/code-snippets.html">Code Snippets</a></li>
        
            
            <li data-order="1"><a href="/supplejack/manager/introduction-to-parser-scripts.html">Introduction to parser scripts</a></li>
        
            
            <li data-order="2"><a href="/supplejack/manager/parser-dsl-domain-specific-language.html">Parser DSL (Domain Specific Language)</a></li>
        
            
            <li data-order="3"><a href="/supplejack/manager/validations.html">Validations</a></li>
        
            
            <li data-order="4"><a href="/supplejack/manager/xml-namespaces.html">XML Namespaces</a></li>
        
            
            <li data-order="5"><a href="/supplejack/manager/attribute-transformation-options.html">Attribute Transformation Options</a></li>
        
            
            <li data-order="6"><a href="/supplejack/manager/enrichments.html">Enrichments</a></li>
        
            
            <li data-order="7"><a href="/supplejack/manager/modifiers.html">Modifiers</a></li>
        
    
        
        

        
            
                <li class=nav-header>Activity Metrics</li>
            
            <li data-order=""><a href="/supplejack/metrics/item-metrics.html">Item Metrics</a></li>
        
            
            <li data-order=""><a href="/supplejack/metrics/usage-metrics.html">Usage Metrics</a></li>
        
    
        
        

        
    
<!-- List additional links. It is recommended to add a divider
    e.g. <li class=divider></li> first to break up the content. -->
</ul>

                    </div>

                    <div id=content class=span10>
                        <div class=page-header>
    <h1>Supplejack API
        
    </h1>
</div>

<p>The Supplejack API is a <a href="http://guides.rubyonrails.org/engines.html">Rails mountable engine</a> that provides functionality to store, index and retrieve metadata via an API. It also includes an API dashboard for monitoring API key activity and setting query throttle rates.</p>

<p>This wiki provides a guide on how to create and configure your API as well as an introduction to the rest of the Supplejack project.</p>

<h2 id="getting-started">Getting started</h2>

<p>Before starting you should check that you have all the <a href="/supplejack/start/dependencies.html">dependencies</a> installed.</p>

<p>Once that is complete we strongly recommend using the <a href="https://github.com/DigitalNZ/supplejack_installation">Supplejack template</a> to create your app. This template will create a new app which includes the Supplejack API engine and then step through the configuration options.</p>

<p>For details about how to install Supplejack Template, see <a href="/supplejack/start/install-setup.html">Install &amp; Setup</a></p>

<p>Once the install is complete you should have a working API. The next step is to <a href="/supplejack/api/creating-schemas.html">configure your schema</a> so that you can configure the fields that are stored/returned by your API.</p>

<h2 id="setup-a-custom-record-model-from-your-api-optional">Setup a custom record model from your API [OPTIONAL]</h2>

<p>If you want to use a custom SupplejackApi::Record model, you can define a supplejack_api.rb initializer file and define the following block:</p>
<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby">SupplejackApi.setup do |config|
  config.record_class = YourCustomClass
  config.preview_record_class = YourPreviewCustomClass
end
</code></pre></figure>
<h2 id="log-record-metric-data">Log Record Metric Data</h2>

<p>By default, Supplejack will log a history of Records that have been viewed in searches and individually, if you do not want this functionality simply set <code>config.log_metrics = false</code> in <code>config/initializers/supplejack_api.rb</code></p>
<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby">SupplejackApi.setup do |config|
  config.log_metrics = false
end
</code></pre></figure>
<p>Make sure your model follow the same structure as the <a href="https://github.com/DigitalNZ/supplejack_api/blob/master/app/models/supplejack_api/record.rb">SupplejackApi::Record</a> and <a href="https://github.com/DigitalNZ/supplejack_api/blob/master/app/models/supplejack_api/preview_record.rb">SupplejackApi::PreviewRecord</a></p>

<p>By setting a custom class you will be able to do for example: YourCustomClass.custom_find(<id>)</p>

<h3 id="generate-api-user-keys">Generate API User keys</h3>

<p>From the Worker&#39;s project root, Run the console.</p>
<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby">rails c
</code></pre></figure>
<p>Create a user.</p>
<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"> &gt; SupplejackApi::User.create(email: &#39;your@email.com&#39;, name: &#39;Your Name&#39;, username: &#39;your_username&#39;)
=&gt; #&lt;SupplejackApi::User _id: 53d58681f694195642000002, created_at: 2014-07-27 23:08:49 UTC, updated_at: 2014-07-27 23:08:49 UTC, email: &quot;your@email.com&quot;, encrypted_password: nil, name: &quot;Your Name&quot;, username: &quot;your_username&quot;, sign_in_count: nil, current_sign_in_at: nil, last_sign_in_at: nil, current_sign_in_ip: nil, last_sign_in_ip: nil, authentication_token: &quot;JmVe15z2BSHDwaVsjMvA&quot;, daily_requests: 0, monthly_requests: 0, max_requests: 10000, role: &quot;developer&quot;, daily_activity: nil, daily_activity_stored: true&gt;
 &gt; SupplejackApi::User.last.authentication_token
=&gt; &quot;RhymLHa9xRQGU8gyAYXP&quot;
</code></pre></figure>
<h3 id="cron-jobs">Cron Jobs</h3>

<p>Supplejack has a few cronjobs that will help with indexing records. You can see examples of them in <code>schedule.example.rb</code>. The main one you should add is the <code>SupplejackApi::IndexRemainingRecordsInQueue</code> as it will index records that are in the Redis queue when there is not yet enough of them to trigger an index automatically.</p>

<h2 id="supplejack-sidekiq">Supplejack Sidekiq</h2>

<p>Supplejack has it&#39;s own instance of Sidekiq that you will need to run for the Full and Flush harvest to work. Start Sidekiq from the api directory with <code>bundle exec sidekiq</code>. If you are running both Sidekiq instances on the same machine, you will need to point them at separate Redis databases otherwise you will end up in problems where the two Sidekiqs are trying to process each others jobs. This can be done by appending <code>/&lt;number&gt;</code> to the end of your Redis URL.</p>


                    </div>
                
            </div>

        </div>

        <script>
            function orderNav() {
                var list,
                    section,
                    header,
                    sections = [],
                    lists = {},
                    headers = {};

                var navUl = document.querySelectorAll('#navigation ul')[0],
                    navLis = document.querySelectorAll('#navigation ul li');

                if (!navUl) return;

                for (var i = 0; i < navLis.length; i++) {
                    var order, li = navLis[i];

                    if (li.classList.contains('nav-header')) {
                        section = li.textContent || li.innerText;
                        sections.push(section);
                        headers[section] = li;
                        continue;
                    }

                    if (!lists[section]) {
                        lists[section] = [];
                    }

                    order = parseFloat(li.getAttribute('data-order'))
                    lists[section].push([order, li]);
                }

                for (var i = 0; i < sections.length; i++) {
                    section = sections[i];
                    list = lists[section].sort(function(a, b) {
                        return a[0] - b[0];
                    });

                    if (header = headers[section]) {
                        navUl.appendChild(header);
                    }
                    for (var j = 0; j < list.length; j++) {
                        navUl.appendChild(list[j][1]);
                    }
                }
            }

            if (document.querySelectorAll) orderNav();
        </script>
    </body>
</html>
