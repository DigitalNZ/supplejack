<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="viewport" content="width=device-width">

        <link rel="apple-touch-icon" sizes="144x144" href="/supplejack/apple-touch-icon.png">
        <link rel="icon" type="image/png" sizes="32x32" href="/supplejack/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/supplejack/favicon-16x16.png">
        <link rel="manifest" href="/supplejack/manifest.json">
        <link rel="mask-icon" href="/supplejack/safari-pinned-tab.svg" color="#118a0f">
        <meta name="theme-color" content="#118a0f">

        <title>Supplejack : Supplejack Worker</title>
        <meta name="description" content="Documentation">

        <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.no-icons.min.css" rel="stylesheet">
        <link rel="stylesheet" href="/supplejack/css/syntax.css">
        <link rel="stylesheet" href="/supplejack/css/main.css">
    </head>
    <body>

        <div class="container">
            <div class=row-fluid>
                <div id=header class=span12>
                    <a href="/supplejack/">
                      <img src="/supplejack/images/supplejack_logo.png" alt='Supplejack' />
                    </a>
                    <small>Documentation (Version 0.1)</small>
                </div>
            </div>

            <div class=row-fluid>
                
                
                    <div id=navigation class=span2>
                        <ul class="nav nav-list">
    <li><a href="/supplejack/">Home</a></li>
    <li><a href="/supplejack/about.html">About</a></li>
    <li><a href="/supplejack/screenshots.html">Screenshots</a></li>
    <li><a href="/supplejack/architecture.html">Architecture</a></li>
    <li><a href="/supplejack/licence.html">Licence</a></li>
    
        
        

        
            
                <li class=nav-header>Installation</li>
            
            <li data-order="3"><a href="/supplejack/start/docker-setup.html">Docker Setup</a></li>
        
            
            <li data-order="11"><a href="/supplejack/start/installation-walk-through-by-example.html">Installation Walk-through by Example</a></li>
        
            
            <li data-order="3"><a href="/supplejack/start/production-install.html">Production Install</a></li>
        
            
            <li data-order="7"><a href="/supplejack/start/supplejack-website.html">Supplejack Website</a></li>
        
            
            <li data-order="6"><a href="/supplejack/start/supplejack-client.html">Supplejack Client</a></li>
        
            
            <li data-order="9"><a href="/supplejack/start/troubleshooting.html">Troubleshooting</a></li>
        
            
            <li data-order="8"><a href="/supplejack/start/supplejack-common.html">Supplejack Common</a></li>
        
            
            <li data-order="2"><a href="/supplejack/start/development-setup.html">Development Setup</a></li>
        
            
            <li data-order="1"><a href="/supplejack/start/dependencies.html">Dependencies</a></li>
        
            
            <li data-order="5"><a href="/supplejack/start/supplejack-worker.html">Supplejack Worker</a></li>
        
            
            <li data-order="4"><a href="/supplejack/start/supplejack-manager.html">Supplejack Manager</a></li>
        
            
            <li data-order="3"><a href="/supplejack/start/supplejack-api.html">Supplejack API</a></li>
        
    
        
        

        
            
                <li class=nav-header>Creating your API</li>
            
            <li data-order="3"><a href="/supplejack/api/api-admin.html">API Admin</a></li>
        
            
            <li data-order="2"><a href="/supplejack/api/schema-dsl-domain-specific-language.html">Schema DSL (Domain Specific Language)</a></li>
        
            
            <li data-order="1"><a href="/supplejack/api/creating-schemas.html">Creating Schemas</a></li>
        
    
        
        

        
            
                <li class=nav-header>Using the API</li>
            
            <li data-order=""><a href="/supplejack/api_usage/metrics-api.html">Metrics API</a></li>
        
            
            <li data-order="2"><a href="/supplejack/api_usage/user-sets.html">Sets API</a></li>
        
            
            <li data-order="1"><a href="/supplejack/api_usage/records-api.html">Records API</a></li>
        
            
            <li data-order="3"><a href="/supplejack/api_usage/concepts-api.html">Concepts API</a></li>
        
    
        
        

        
            
                <li class=nav-header>Using the manager</li>
            
            <li data-order="11"><a href="/supplejack/manager/job-status.html">Job Status</a></li>
        
            
            <li data-order="10"><a href="/supplejack/manager/concept-configuration.html">Concepts Configuration</a></li>
        
            
            <li data-order="9"><a href="/supplejack/manager/linkchecker.html">Link Checker</a></li>
        
            
            <li data-order="8"><a href="/supplejack/manager/code-snippets.html">Code Snippets</a></li>
        
            
            <li data-order="1"><a href="/supplejack/manager/introduction-to-parser-scripts.html">Introduction to parser scripts</a></li>
        
            
            <li data-order="2"><a href="/supplejack/manager/parser-dsl-domain-specific-language.html">Parser DSL (Domain Specific Language)</a></li>
        
            
            <li data-order="3"><a href="/supplejack/manager/validations.html">Validations</a></li>
        
            
            <li data-order="4"><a href="/supplejack/manager/xml-namespaces.html">XML Namespaces</a></li>
        
            
            <li data-order="5"><a href="/supplejack/manager/attribute-transformation-options.html">Attribute Transformation Options</a></li>
        
            
            <li data-order="6"><a href="/supplejack/manager/enrichments.html">Enrichments</a></li>
        
            
            <li data-order="7"><a href="/supplejack/manager/modifiers.html">Modifiers</a></li>
        
    
        
        

        
            
                <li class=nav-header>Activity Metrics</li>
            
            <li data-order=""><a href="/supplejack/metrics/item-metrics.html">Item Metrics</a></li>
        
            
            <li data-order=""><a href="/supplejack/metrics/usage-metrics.html">Usage Metrics</a></li>
        
    
        
        

        
    
<!-- List additional links. It is recommended to add a divider
    e.g. <li class=divider></li> first to break up the content. -->
</ul>

                    </div>

                    <div id=content class=span10>
                        <div class=page-header>
    <h1>Supplejack Worker
        
    </h1>
</div>

<p>The harvester worker is a rails application that uses <a href="http://sidekiq.org/">Sidekiq</a> to run all of the various jobs that occur in the harvesting and link checking process.</p>

<h3 id="harvesting-jobs">Harvesting jobs</h3>

<p>These use the harvester core gem to interpret a given parser which it uses to generate records and posts them to the Supplejack API (this is a simplified overview of the process).</p>

<h3 id="preview-job">Preview Job</h3>

<p>A preview job is initiated from the manager when a parser is previewed. The worker returns a snapshot of the how the records will look like when created.</p>

<h3 id="link-checking-jobs">Link checking jobs</h3>

<p>This job checks individual records which have been visited recently (in the API) and suppresses records which are unavailable.</p>

<h3 id="source-checking-job">Source checking job</h3>

<p>This job checks a few records from a collection and suppresses collections which are unavailable.</p>

<h3 id="job-priorities">Job priorities</h3>

<p>There are 3 priority levels for Jobs in supplejack worker. Preview is the only <code>critical</code> priority job, which is the highest priority. Link Check job has <code>low</code> priority. All the other jobs are configured with <code>default</code> priority.</p>

<h3 id="supplejack-api-integration">Supplejack API integration</h3>

<p>Supplejack API harvester endpoints requires an API key with harvester privileges that is configured as enrironment variable. <code>HARVESTER_API_KEY</code>.</p>

<h3 id="sidekiq">Sidekiq</h3>

<p>Jobs are processed by Sidekiq, which runs as a part of the worker. In order to start Sidekiq run <code>bundle exec sidekiq start</code>. You can then look at <a href="http://WORKER_HOST/sidekiq">http://WORKER_HOST/sidekiq</a> to view progress.  </p>

<p>If you are having issues with your Sidekiq worker jobs not running correctly you can add log output by following <a href="https://github.com/javan/whenever/wiki/Output-redirection-aka-logging-your-cron-jobs">these</a> instructions. The most likely cause of issues is that the environment variables are not setup correctly for the cron script and the workers are unable to find the Ruby gems installed on the system</p>

<h3 id="generate-worker-user-keys">Generate Worker User keys</h3>

<p>From the Worker&#39;s project root, Create a user from the console:</p>
<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby">rails c
 &gt; User.create!
=&gt; #&lt;User _id: 53714f99531163b56c000001, authentication_token: &quot;RhymLHa9xRQGU8gyAYXP&quot;&gt;
 &gt; User.last.authentication_token
=&gt; &quot;RhymLHa9xRQGU8gyAYXP&quot;
</code></pre></figure>
<h3 id="environment-configurations">Environment Configurations</h3>
<figure class="highlight"><pre><code class="language-yaml" data-lang="yaml"># Example Supplejack Worker application.yml file

development:
  API_HOST: &quot;http://localhost:3000&quot;
  HARVESTER_API_KEY: &lt;YOUR_HARVESTER_KEY&gt;
  API_MONGOID_HOSTS: &quot;localhost:27017&quot;
  MANAGER_HOST: &quot;http://localhost:3001&quot;
  HARVESTER_CACHING_ENABLED: true
  AIRBRAKE_API_KEY: &quot;abc123&quot;
  LINK_CHECKING_ENABLED: &quot;true&quot;
  LINKCHECKER_RECIPIENTS: &quot;test@example.com&quot;
  WORKER_KEY: &lt;YOUR_WORKER_KEY&gt;

production:
  API_HOST: &quot;http://api.example.com&quot;
  HARVESTER_API_KEY: &lt;YOUR_HARVESTER_KEY&gt;
  API_MONGOID_HOSTS: &quot;localhost:27017&quot;
  MANAGER_HOST: &quot;http://harvester.example.com&quot;
  HARVESTER_CACHING_ENABLED: true
  AIRBRAKE_API_KEY: &quot;abc123&quot;
  LINK_CHECKING_ENABLED: &quot;true&quot;
  LINKCHECKER_RECIPIENTS: &quot;test@example.com&quot;
  WORKER_KEY: &lt;YOUR_WORKER_KEY&gt;
</code></pre></figure>

                    </div>
                
            </div>

        </div>

        <script>
            function orderNav() {
                var list,
                    section,
                    header,
                    sections = [],
                    lists = {},
                    headers = {};

                var navUl = document.querySelectorAll('#navigation ul')[0],
                    navLis = document.querySelectorAll('#navigation ul li');

                if (!navUl) return;

                for (var i = 0; i < navLis.length; i++) {
                    var order, li = navLis[i];

                    if (li.classList.contains('nav-header')) {
                        section = li.textContent || li.innerText;
                        sections.push(section);
                        headers[section] = li;
                        continue;
                    }

                    if (!lists[section]) {
                        lists[section] = [];
                    }

                    order = parseFloat(li.getAttribute('data-order'))
                    lists[section].push([order, li]);
                }

                for (var i = 0; i < sections.length; i++) {
                    section = sections[i];
                    list = lists[section].sort(function(a, b) {
                        return a[0] - b[0];
                    });

                    if (header = headers[section]) {
                        navUl.appendChild(header);
                    }
                    for (var j = 0; j < list.length; j++) {
                        navUl.appendChild(list[j][1]);
                    }
                }
            }

            if (document.querySelectorAll) orderNav();
        </script>
    </body>
</html>
